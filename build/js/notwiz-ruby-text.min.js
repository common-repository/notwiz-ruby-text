!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){t.exports=React},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"name",function(){return h}),n.d(r,"settings",function(){return m});var o={};n.r(o),n.d(o,"name",function(){return S}),n.d(o,"settings",function(){return E});var u={};function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.r(u),n.d(u,"name",function(){return ht}),n.d(u,"settings",function(){return mt});var f=wp.i18n.__,p=wp.element,y=p.Component,b=p.Fragment,h="notwiz-ruby-text/ruby-parentheses",m={title:f("Ruby Parentheses","notwiz-ruby-text"),tagName:"rp",className:null,edit:function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,l(e).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,y),n=e,(r=[{key:"render",value:function(){return wp.element.createElement(b,null)}}])&&a(n.prototype,r),o&&a(n,o),e}()};function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var O=wp.i18n.__,x=wp.element,R=x.Component,j=x.Fragment,S="notwiz-ruby-text/ruby-text",E={title:O("Ruby Text","notwiz-ruby-text"),tagName:"rt",className:null,edit:function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,w(e).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(e,R),n=e,(r=[{key:"render",value:function(){return wp.element.createElement(j,null)}}])&&d(n.prototype,r),o&&d(n,o),e}()},z=n(0),P=n.n(z);function C(){return(C=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var M=P.a.createElement("path",{d:"M9.238 6.53v-.088c0-.048 0-.064-.008-.112-.072-.664-.08-.8-.088-1.832a3.598 3.598 0 0 1 1.497-.168c-.369.84-.705 1.4-1.225 2-.064.064-.072.08-.152.208l-.024-.008zm-.592-1.832c0 .968.048 1.552.16 2.168-.36.288-.624.408-.92.408-.344 0-.576-.288-.576-.728 0-.4.176-.824.488-1.192.224-.256.456-.44.848-.656M7.022 2.946c.056-.008.096-.008.128-.008.016 0 .072 0 .144.008.64.024 1 .04 1.08.04h.32c-.04.584-.04.624-.048 1.208-1.16.504-1.856 1.4-1.856 2.384 0 .712.432 1.216 1.032 1.216.56 0 1.168-.328 1.784-.968.624-.632 1.056-1.32 1.52-2.4.864.224 1.32.704 1.32 1.392 0 .712-.504 1.296-1.375 1.6-.385.136-.729.2-1.201.216.144.216.184.304.256.536.72-.088 1.176-.216 1.632-.456.824-.432 1.256-1.064 1.256-1.848 0-.936-.615-1.616-1.72-1.872a9.56 9.56 0 0 1 .248-.64l-.552-.168c-.032.24-.095.48-.192.72-.2-.016-.296-.024-.464-.024-.424 0-.776.048-1.184.16.008-.392.008-.392.056-1.072a22.41 22.41 0 0 0 2.832-.32c.152-.024.176-.024.281-.04l-.033-.56c-.608.216-1.744.384-3.048.448.056-.624.096-.896.168-1.12l-.624-.04c.008.056.008.104.008.12 0 .056-.016.368-.024.456-.032.408-.032.408-.04.6-.144.008-.176.008-.2.008-.736 0-1.16-.032-1.496-.128l-.008.552zm1.124 12.555h-1.98v-2.844h1.98v2.844zm2.665 0h-1.92v-2.844h1.92v2.844zm.744-2.844h2.063v2.844h-2.063v-2.844zM8.89 16.161h1.92v2.376H8.89v-2.376zm0-6.06h1.92v1.883H8.89v-1.883zm-.744 0v1.884h-1.38c-.576 0-1.008-.012-1.416-.06.048.349.06.66.06 1.188v1.92c0 .528-.012.84-.06 1.188.396-.035.876-.06 1.416-.06h1.38v2.376H5.794c-.588 0-.96-.023-1.332-.084v.876c.432-.059.78-.084 1.368-.084h8.149c.576 0 .924.025 1.355.084v-.876c-.359.061-.732.084-1.32.084h-2.459v-2.376h1.451c.54 0 1.02.025 1.416.06-.048-.336-.06-.636-.06-1.188v-1.92c0-.552.012-.852.06-1.188-.408.048-.84.06-1.439.06h-1.428v-1.884h2.303c.564 0 .949.024 1.32.072v-.84a9.812 9.812 0 0 1-1.332.072H5.962a9.7 9.7 0 0 1-1.332-.072v.84c.384-.048.756-.072 1.344-.072h2.172z"}),k=function(t){return P.a.createElement("svg",C({width:20,height:20,viewBox:"0 0 20 20","aria-hidden":"true"},t),M)};function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function V(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var I=wp.element.Component,B=wp.dom,H=B.getOffsetParent,q=B.getRectangleFromRange;function D(){var t=window.getSelection();if(0===t.rangeCount)return{};var e=q(t.getRangeAt(0)),n=e.top+e.height,r=e.left+e.width/2,o=H(t.anchorNode);if(o){var u=o.getBoundingClientRect();n-=u.top,r-=u.left}return{top:n,left:r}}var W=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=V(this,F(e).apply(this,arguments))).state={style:D()},t}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(e,I),n=e,(r=[{key:"render",value:function(){var t=this.props.children,e=this.state.style;return wp.element.createElement("div",{className:"editor-format-toolbar__selection-position",style:e},t)}}])&&N(n.prototype,r),o&&N(n,o),e}();function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var U=wp.i18n.__,X=wp.element,Y=X.Component,Z=X.Fragment,$=wp.editor.RichTextToolbarButton,tt=wp.components,et=tt.TextControl,nt=tt.IconButton,rt=tt.Popover,ot=tt.Modal,ut=wp.richText,it=ut.insert,at=ut.applyFormat,ct=ut.removeFormat,lt=ut.getActiveFormat,st=ut.getTextContent,ft=ut.slice,pt="notwiz-ruby-text/ruby-parentheses",yt="notwiz-ruby-text/ruby-text",bt="notwiz-ruby-text/ruby",ht="notwiz-ruby-text/ruby",mt={title:U("Ruby","notwiz-ruby-text"),tagName:"ruby",className:null,edit:function(t){function e(){var t,n,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=this,(t=!(r=K(e).apply(this,arguments))||"object"!==G(r)&&"function"!=typeof r?L(n):r).addRuby=t.addRuby.bind(L(t)),t.cancelRuby=t.cancelRuby.bind(L(t)),t.removeRuby=t.removeRuby.bind(L(t)),t.submitRuby=t.submitRuby.bind(L(t)),t.onChangeInputValue=t.onChangeInputValue.bind(L(t)),t.state={addingRuby:!1,inputValue:"",errorMessage:null},t}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(e,Y),n=e,(r=[{key:"addRuby",value:function(){var t=this.props.value;t&&t.start!==t.end?t.end!==t.text.length?this.setState({addingRuby:!0,inputValue:"",errorMessage:null}):this.setErrorMessage(U("Can not select the last character in the text to decorate ruby text","notwiz-ruby-text")):this.setErrorMessage(U("Choose a string to decorate ruby text","notwiz-ruby-text"))}},{key:"cancelRuby",value:function(){this.setState({addingRuby:!1,inputValue:"",errorMessage:null})}},{key:"removeRuby",value:function(){var t=this.props,e=t.value,n=t.onChange;if(e&&lt(e,bt)){var r=e;r.end!==r.start&&(r.end=r.start),r=ct(r,pt),r=ct(r,yt),n(r=ct(r,bt))}else this.setErrorMessage(U("The decoration may have already been removed","notwiz-ruby-text"))}},{key:"submitRuby",value:function(t){t.preventDefault();var e=this.props,n=e.value,r=e.onChange,o=this.state.inputValue;if(st(ft(n)).length>0){var u=o;if(u&&u.length>0){var i=n,a=i.start,c=i.end;i=it(i,"《",c),i=it(i,u,c+"《".length),(i=it(i,"》",c+"《".length+u.length)).start=a,i.end=c+"《".length+u.length+"》".length,i=at(i,{type:bt},a,c+"《".length+u.length+"》".length),i=at(i,{type:pt},c,c+"《".length),i=at(i,{type:yt},c+"《".length,c+"《".length+u.length),r(i=at(i,{type:pt},c+"《".length+u.length,c+"《".length+u.length+"》".length))}}this.cancelRuby()}},{key:"onChangeInputValue",value:function(t){this.setState({inputValue:t})}},{key:"setErrorMessage",value:function(t){this.setState({errorMessage:t})}},{key:"render",value:function(){var t=this,e=this.props,n=e.isActive,r=e.value;return wp.element.createElement(Z,null,n&&wp.element.createElement($,{icon:k(),title:U("Ruby","notwiz-ruby-text"),onClick:this.removeRuby,isActive:n}),!n&&wp.element.createElement($,{icon:k(),title:U("Ruby","notwiz-ruby-text"),onClick:this.addRuby,isActive:n}),!n&&this.state.addingRuby?wp.element.createElement(W,{key:"".concat(r.start).concat(r.end)},wp.element.createElement(rt,{className:"notwiz-ruby-text__edit-container",onClickOutside:this.cancelRuby,onClose:this.cancelRuby,focusOnMount:"firstElement",position:"bottom"},wp.element.createElement("form",{className:"notwiz-ruby-text__edit-container__form",onSubmit:this.submitRuby},wp.element.createElement(et,{className:"notwiz-ruby-text__edit-container__text-container",value:this.state.inputValue,required:"required",onChange:function(e){return t.onChangeInputValue(e)},placeholder:U("Enter ruby text","notwiz-ruby-text")}),wp.element.createElement(nt,{className:"notwiz-ruby-text__edit-container__button",type:"submit",icon:"editor-break",label:U("Apply","notwiz-ruby-text")})))):"",null!==this.state.errorMessage&&wp.element.createElement(ot,{title:U("Warning","notwiz-ruby-text"),onRequestClose:function(){return t.setErrorMessage(null)}},this.state.errorMessage))}}])&&J(n.prototype,r),o&&J(n,o),e}()},vt=wp.richText.registerFormatType;[r,o,u].forEach(function(t){var e=t.name,n=t.settings;vt(e,n)})}]);